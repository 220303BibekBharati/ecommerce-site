<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Orders – BIBTRENDS</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect width='64' height='64' rx='14' ry='14' fill='%235b36ff'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dominant-baseline='central' font-family='system-ui, -apple-system, BlinkMacSystemFont, Roboto, sans-serif' font-size='34' font-weight='700' fill='white'%3EB%3C/text%3E%3C/svg%3E" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="page-shell">
    <main class="app-container">
      <header class="panel-header">
        <div>
          <div class="section-title">Orders overview</div>
          <div class="section-subtitle">All orders stored in this browser.</div>
        </div>
        <a href="shop.html" class="nav-link">← Back to shop</a>
      </header>
      <section class="panel">
        <div id="orders-view"></div>
      </section>
    </main>
  </div>
  <script>
    const ORDERS_KEY='ecom_orders';
    const CURRENT_USER_KEY='currentUser';
    function formatPrice(v){return '$'+v.toFixed(2);}    
    function getOrders(){try{const r=localStorage.getItem(ORDERS_KEY);return r?JSON.parse(r):[]}catch{return []}}    
    function getCurrentUser(){try{const r=localStorage.getItem(CURRENT_USER_KEY);return r?JSON.parse(r):null}catch{return null}}
    function statusClass(s){const m={Pending:'status-pending',Processing:'status-processing',Shipped:'status-shipped',Delivered:'status-delivered',Canceled:'status-canceled'};return m[s]||'status-pending';}
    function render(){
      const root=document.getElementById('orders-view');
      const orders=getOrders();
      const user=getCurrentUser();
      const scoped=user?orders.filter(o=>
        o.userEmail===user.email||
        o.userId===user.id
      ):[];
      if(!scoped.length){root.innerHTML='<p class="text-muted">No orders for this account yet.</p>';return;}
      root.innerHTML=scoped.map(o=>{
        const d=new Date(o.createdAt).toLocaleString();
        const itemsLabel=`${o.items.length} item${o.items.length>1?'s':''}`;
        return `<article class="order-card">
          <div class="order-header">
            <div><div style="font-size:0.78rem;">${o.id}</div><div class="text-muted" style="font-size:0.72rem;">${d}</div></div>
            <span class="status-pill ${statusClass(o.status)}">${o.status}</span>
          </div>
          <div class="order-body">
            <div class="cart-row"><span>${itemsLabel}</span><span>${formatPrice(o.total)}</span></div>
          </div>
        </article>`;
      }).join('');
    }
    document.addEventListener('DOMContentLoaded',render);
  </script>
</body>
</html>
